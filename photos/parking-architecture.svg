<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 780" width="1200" height="780" role="img" aria-labelledby="title desc">
  <title id="title">Campus Parking Platform Architecture</title>
  <desc id="desc">Frontends in Next.js connect through NGINX to microservices (Auth, Permit, Vehicle, Ticket, Stripe). Services use PostgreSQL databases and integrate with Stripe Checkout and Mailgun. Police and Registrar partner APIs access Permit/Ticket with API-key validation via Auth.</desc>

  <defs>
    <style>
      .ink{ stroke:#20302a; stroke-width:3; }
      .text{ font: 14px Arial, Helvetica, sans-serif; fill:#20302a; }
      .label{ font: 700 14px Arial, Helvetica, sans-serif; fill:#20302a; }
      .hlabel{ font: 800 16px Georgia, serif; fill:#0a4f45; }
      .chip{ font: 12px Arial, Helvetica, sans-serif; fill:#0e6b5d; }
      .box{ fill:#ffffff; }
      .card{ fill:#ffffff; }
      .soft{ fill:#e5f5ef; }
      .muted{ fill:#f7fbfa; }
      .ext{ fill:#eaf2ff; }
      .warn{ fill:#fff7e6; }
      .db{ fill:#ffffff; }
      .shadow{ filter:url(#shadow); }
      .arrow{ stroke:#20302a; stroke-width:2.5; fill:none; marker-end:url(#arrowHead); }
      .dash{ stroke-dasharray:6 6; }
    </style>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="6" dy="6" stdDeviation="0" flood-color="rgba(0,0,0,0.16)"/>
    </filter>
    <marker id="arrowHead" markerWidth="10" markerHeight="8" refX="9" refY="4" orient="auto">
      <path d="M0,0 L10,4 L0,8 z" fill="#20302a" />
    </marker>
  </defs>

  <!-- BACKDROP -->
  <rect x="0" y="0" width="1200" height="780" fill="#f7fbfa"/>

  <!-- FRONTENDS ROW -->
  <g class="shadow">
    <rect class="box ink" x="45" y="40" rx="12" ry="12" width="240" height="76"/>
    <text class="label" x="165" y="76" text-anchor="middle">Driver App</text>
    <text class="chip"  x="165" y="98" text-anchor="middle">Next.js • en/es • NextAuth</text>
  </g>
  <g class="shadow">
    <rect class="box ink" x="325" y="40" rx="12" ry="12" width="240" height="76"/>
    <text class="label" x="445" y="76" text-anchor="middle">Enforcement App</text>
    <text class="chip"  x="445" y="98" text-anchor="middle">Next.js • role‑gated</text>
  </g>
  <g class="shadow">
    <rect class="box ink" x="605" y="40" rx="12" ry="12" width="240" height="76"/>
    <text class="label" x="725" y="76" text-anchor="middle">Admin App</text>
    <text class="chip"  x="725" y="98" text-anchor="middle">Next.js • dashboards</text>
  </g>
  <g class="shadow">
    <rect class="box ink" x="885" y="40" rx="12" ry="12" width="240" height="76"/>
    <text class="label" x="1005" y="76" text-anchor="middle">Landing Page</text>
    <text class="chip"  x="1005" y="98" text-anchor="middle">Next.js • i18n</text>
  </g>

  <!-- NGINX GATEWAY -->
  <g class="shadow">
    <rect class="soft ink" x="45" y="140" rx="12" ry="12" width="1080" height="56"/>
    <text class="hlabel" x="585" y="173" text-anchor="middle">NGINX • SSL • HTTP/2 • Routing</text>
  </g>

  <!-- ARROWS: FE -> NGINX -->
  <path class="arrow" d="M165,116 L165,140"/>
  <path class="arrow" d="M445,116 L445,140"/>
  <path class="arrow" d="M725,116 L725,140"/>
  <path class="arrow" d="M1005,116 L1005,140"/>

  <!-- MICROSERVICES GROUP -->
  <g class="shadow">
    <rect class="muted ink" x="45" y="220" rx="16" ry="16" width="880" height="220"/>
    <text class="hlabel" x="70" y="246">Microservices</text>

    <!-- services -->
    <g>
      <rect class="box ink" x="65" y="260" rx="12" ry="12" width="160" height="60"/>
      <text class="label" x="145" y="290" text-anchor="middle">Auth</text>
      <text class="chip"  x="145" y="308" text-anchor="middle">REST • JWT/roles</text>
    </g>
    <g>
      <rect class="box ink" x="245" y="260" rx="12" ry="12" width="160" height="60"/>
      <text class="label" x="325" y="290" text-anchor="middle">Permit</text>
      <text class="chip"  x="325" y="308" text-anchor="middle">GraphQL</text>
    </g>
    <g>
      <rect class="box ink" x="425" y="260" rx="12" ry="12" width="160" height="60"/>
      <text class="label" x="505" y="290" text-anchor="middle">Vehicle</text>
      <text class="chip"  x="505" y="308" text-anchor="middle">GraphQL</text>
    </g>
    <g>
      <rect class="box ink" x="605" y="260" rx="12" ry="12" width="160" height="60"/>
      <text class="label" x="685" y="290" text-anchor="middle">Ticket</text>
      <text class="chip"  x="685" y="308" text-anchor="middle">GraphQL</text>
    </g>
    <g>
      <rect class="box ink" x="785" y="260" rx="12" ry="12" width="120" height="60"/>
      <text class="label" x="845" y="290" text-anchor="middle">Stripe</text>
      <text class="chip"  x="845" y="308" text-anchor="middle">REST</text>
    </g>
  </g>

  <!-- Arrow: NGINX -> Microservices -->
  <path class="arrow" d="M585,196 L585,220"/>

  <!-- PARTNER APIS -->
  <g class="shadow">
    <rect class="ext ink" x="950" y="240" rx="16" ry="16" width="200" height="180"/>
    <text class="hlabel" x="965" y="266">Partner APIs</text>
    <g>
      <rect class="box ink" x="970" y="280" rx="10" ry="10" width="160" height="48"/>
      <text class="label" x="1050" y="308" text-anchor="middle">Police</text>
    </g>
    <g>
      <rect class="box ink" x="970" y="340" rx="10" ry="10" width="160" height="48"/>
      <text class="label" x="1050" y="368" text-anchor="middle">Registrar</text>
    </g>
  </g>

  <!-- PROVIDERS -->
  <g class="shadow">
    <rect class="ext ink" x="950" y="440" rx="16" ry="16" width="200" height="180"/>
    <text class="hlabel" x="965" y="466">Providers</text>
    <g>
      <rect class="box ink" x="970" y="480" rx="10" ry="10" width="160" height="48"/>
      <text class="label" x="1050" y="508" text-anchor="middle">Mailgun</text>
    </g>
    <g>
      <rect class="box ink" x="970" y="540" rx="10" ry="10" width="160" height="48"/>
      <text class="label" x="1050" y="568" text-anchor="middle">Stripe Checkout</text>
    </g>
  </g>

  <!-- DATABASE GROUP -->
  <g class="shadow">
    <rect class="muted ink" x="45" y="480" rx="16" ry="16" width="880" height="240"/>
    <text class="hlabel" x="70" y="506">PostgreSQL (per domain)</text>

    <!-- DBs as cylinders (rect + ellipse) -->
    <g>
      <rect class="db ink" x="80" y="520" width="180" height="90" rx="12"/>
      <ellipse class="db ink" cx="170" cy="520" rx="90" ry="16"/>
      <text class="label" x="170" y="574" text-anchor="middle">Auth DB</text>
    </g>
    <g>
      <rect class="db ink" x="300" y="520" width="180" height="90" rx="12"/>
      <ellipse class="db ink" cx="390" cy="520" rx="90" ry="16"/>
      <text class="label" x="390" y="574" text-anchor="middle">Permit DB</text>
    </g>
    <g>
      <rect class="db ink" x="520" y="520" width="180" height="90" rx="12"/>
      <ellipse class="db ink" cx="610" cy="520" rx="90" ry="16"/>
      <text class="label" x="610" y="574" text-anchor="middle">Vehicle DB</text>
    </g>
    <g>
      <rect class="db ink" x="740" y="520" width="160" height="90" rx="12"/>
      <ellipse class="db ink" cx="820" cy="520" rx="80" ry="16"/>
      <text class="label" x="820" y="574" text-anchor="middle">Ticket DB</text>
    </g>
  </g>

  <!-- WIRES: microservices -> DBs -->
  <path class="arrow" d="M145,320 L145,520"/>
  <path class="arrow" d="M325,320 L325,520"/>
  <path class="arrow" d="M505,320 L505,520"/>
  <path class="arrow" d="M685,320 L685,520"/>

  <!-- WIRES: microservices -> providers -->
  <path class="arrow" d="M685,320 C880,320 880,480 970,504"/>
  <path class="arrow" d="M325,320 C920,320 920,540 970,540"/>
  <path class="arrow" d="M845,320 L970,564"/>

  <!-- WIRES: partners -> services (solid) -->
  <path class="arrow" d="M970,304 L405,304"/>
  <path class="arrow" d="M970,364 L605,304"/>
  <!-- WIRES: partners -> auth (dashed for API key validation) -->
  <path class="arrow dash" d="M1130,304 L225,304"/>
  <path class="arrow dash" d="M1130,364 L225,304"/>

  <!-- LEGEND (bottom-left) -->
  <g>
    <rect class="box ink shadow" x="45" y="736" rx="8" ry="8" width="390" height="30"/>
    <circle class="soft ink" cx="62" cy="751" r="6"/>
    <text class="text" x="75" y="756">Internal node</text>
    <circle class="ext ink" cx="190" cy="751" r="6"/>
    <text class="text" x="203" y="756">External/Partner</text>
    <line class="arrow" x1="325" y1="751" x2="360" y2="751"/>
    <text class="text" x="368" y="756">Flow</text>
  </g>
</svg>

